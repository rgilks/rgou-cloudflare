(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2604:(e,t,r)=>{"use strict";e.exports=r.p+"static/media/rust_ai_wasm_bg.77ab56e3.wasm"},2946:(e,t,r)=>{Promise.resolve().then(r.bind(r,8067))},8067:(e,t,r)=>{"use strict";let a;r.d(t,{default:()=>F});var n=r(5155),l=r(2115);let s=[4,8,14],i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],o=[16,17,18,19,4,5,6,7,8,9,10,11,12,13,14,15];function c(){let e=Array(7).fill(null).map(()=>({square:-1,player:"player1"})),t=Array(7).fill(null).map(()=>({square:-1,player:"player2"}));return{board:Array(20).fill(null),player1Pieces:e,player2Pieces:t,currentPlayer:"player1",gameStatus:"playing",winner:null,diceRoll:null,canMove:!1,validMoves:[]}}function d(e){return"player1"===e?i:o}function u(e,t){let r=d(e);return t>=0&&t<r.length?r[t]:-1}function y(e){return s.includes(e)}function f(e,t){if(!e.validMoves.includes(t)||!e.diceRoll)return e;let r={...e},a="player1"===e.currentPlayer,n=a?[...e.player1Pieces]:[...e.player2Pieces],l=n[t],s=(-1===l.square?-1:d(e.currentPlayer).indexOf(l.square))+e.diceRoll;if(l.square>=0&&(r.board[l.square]=null),s>=d(e.currentPlayer).length)n[t]={...l,square:20};else{let i=u(e.currentPlayer,s),o=e.board[i];if(o&&o.player!==e.currentPlayer){let t=a?[...e.player2Pieces]:[...e.player1Pieces],n=t.findIndex(e=>e.square===i);n>=0&&(t[n]={...t[n],square:-1},a?r.player2Pieces=t:r.player1Pieces=t)}n[t]={...l,square:i},r.board[i]=n[t]}return a?r.player1Pieces=n:r.player2Pieces=n,7===n.filter(e=>20===e.square).length&&(r.gameStatus="finished",r.winner=e.currentPlayer),s<d(e.currentPlayer).length&&y(u(e.currentPlayer,s))||"finished"===r.gameStatus||(r.currentPlayer="player1"===e.currentPlayer?"player2":"player1"),r.diceRoll=null,r.canMove=!1,r.validMoves=[],r}function p(e){let t=function(){let e=0;for(let t=0;t<4;t++).5>Math.random()&&e++;return e}(),r={...e,diceRoll:t,canMove:t>0,validMoves:t>0?function(e){if(!e.diceRoll||0===e.diceRoll)return[];let t="player1"===e.currentPlayer?e.player1Pieces:e.player2Pieces,r=[];return t.forEach((t,a)=>{let n=(-1===t.square?-1:d(e.currentPlayer).indexOf(t.square))+e.diceRoll;if(n>=d(e.currentPlayer).length)n===d(e.currentPlayer).length&&r.push(a);else{let t=u(e.currentPlayer,n),l=e.board[t];l&&(l.player===e.currentPlayer||y(t))||r.push(a)}}),r}({...e,diceRoll:t}):[]};return t>0&&0===r.validMoves.length?{...r,currentPlayer:"player1"===e.currentPlayer?"player2":"player1",diceRoll:null,canMove:!1,validMoves:[]}:r}let m=r(9509).env.NEXT_PUBLIC_AI_WORKER_URL||"https://rgou-ai-worker.rob-gilks.workers.dev";class b{static async makeRequest(e,t){let r="".concat(m).concat(e);try{let e=await fetch(r,{method:t?"POST":"GET",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(t){throw console.error("AI Service error for ".concat(e,":"),t),Error("Failed to communicate with AI service: ".concat(t))}}static async getAIMove(e){return this.makeRequest("/ai-move",e)}static async evaluatePosition(e){return this.makeRequest("/evaluate",e)}static async healthCheck(){return this.makeRequest("/health")}static getFallbackAIMove(e){if(!e.canMove||0===e.validMoves.length)return 0;let t=Math.floor(Math.random()*e.validMoves.length);return e.validMoves[t]}}let h="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&h.decode();let g=null;function x(){return(null===g||0===g.byteLength)&&(g=new Uint8Array(a.memory.buffer)),g}function v(e,t){return e>>>=0,h.decode(x().subarray(e,e+t))}let w=0,_="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},P="function"==typeof _.encodeInto?function(e,t){return _.encodeInto(e,t)}:function(e,t){let r=_.encode(e);return t.set(r),{read:e.length,written:r.length}},j=null;function N(){return(null===j||!0===j.buffer.detached||void 0===j.buffer.detached&&j.buffer!==a.memory.buffer)&&(j=new DataView(a.memory.buffer)),j}async function M(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"!=e.headers.get("Content-Type"))console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}let r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{let r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}async function k(e){var t,n;if(void 0!==a)return a;void 0!==e&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),void 0===e&&(e=new r.U(r(2604)));let l=function(){let e={};return e.wbg={},e.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let r,n;try{r=e,n=t,console.error(v(e,t))}finally{a.__wbindgen_free(r,n,1)}},e.wbg.__wbg_new_8a6f238a6ece86ea=function(){return Error()},e.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){let r=function(e,t,r){if(void 0===r){let r=_.encode(e),a=t(r.length,1)>>>0;return x().subarray(a,a+r.length).set(r),w=r.length,a}let a=e.length,n=t(a,1)>>>0,l=x(),s=0;for(;s<a;s++){let t=e.charCodeAt(s);if(t>127)break;l[n+s]=t}if(s!==a){0!==s&&(e=e.slice(s)),n=r(n,a,a=s+3*e.length,1)>>>0;let t=P(e,x().subarray(n+s,n+a));s+=t.written,n=r(n,a,s,1)>>>0}return w=s,n}(t.stack,a.__wbindgen_malloc,a.__wbindgen_realloc),n=w;N().setInt32(e+4,n,!0),N().setInt32(e+0,r,!0)},e.wbg.__wbindgen_init_externref_table=function(){let e=a.__wbindgen_export_3,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},e.wbg.__wbindgen_throw=function(e,t){throw Error(v(e,t))},e}();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));let{instance:s,module:i}=await M(await e,l);return t=s,n=i,a=t.exports,k.__wbindgen_wasm_module=n,j=null,g=null,a.__wbindgen_start(),a}Object.freeze({One:0,0:"One",Two:1,1:"Two"}),"undefined"==typeof FinalizationRegistry||new FinalizationRegistry(e=>a.__wbg_gamestate_free(e>>>0,1)),"undefined"==typeof FinalizationRegistry||new FinalizationRegistry(e=>a.__wbg_rustai_free(e>>>0,1));let A=null;async function R(){A||(A=await k(),console.log("WASM module initialized"))}class I{getAIMove(e){if(!this.ai)throw Error("AI not initialized");let t=function(e){let t=new Int8Array(7),r=new Int8Array(7);return e.player1Pieces.forEach((e,r)=>{t[r]=e.square}),e.player2Pieces.forEach((e,t)=>{r[t]=e.square}),{p1_pieces:t,p2_pieces:r,current_player:+("player1"!==e.currentPlayer),dice_roll:e.diceRoll||0}}(e);return this.ai.update_game_state(t.p1_pieces,t.p2_pieces,t.current_player,t.dice_roll),this.ai.get_ai_move()}destroy(){this.ai&&(this.ai=null)}constructor(){if(this.ai=null,!A)throw Error("WASM not initialized. Call initializeWasm() first.");this.ai=new A.RustAI}}var q=r(2596),S=r(9688);function C(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,S.QP)((0,q.$)(t))}var E=r(1934);let T=l.memo(function(e){let{player:t,isClickable:r}=e;return(0,n.jsx)(E.P.div,{className:C("w-full h-full rounded-full border-2","player1"===t?"bg-blue-500 border-blue-700":"bg-red-500 border-red-700",r&&"cursor-pointer"),initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{type:"spring",stiffness:500,damping:30}})});function O(e){let{gameState:t,onPieceClick:r}=e,a=(e,r)=>("player1"===r?t.player1Pieces:t.player2Pieces).findIndex(t=>t.square===e),l=(e,l)=>{let i=s.includes(e),o=t.board[e],c=o?a(e,o.player):-1,d=!!(o&&-1!==c&&t.validMoves.includes(c)&&t.currentPlayer===o.player);return(0,n.jsxs)("div",{className:C("w-full aspect-square border border-stone-400 bg-stone-200 flex items-center justify-center relative",i&&"bg-rose-200",d&&"ring-2 ring-green-500 z-10"),onClick:()=>d&&r(c),children:[i&&(0,n.jsx)("span",{className:"absolute text-lg text-rose-600",children:"â˜…"}),o&&(0,n.jsx)("div",{className:"w-4/5 h-4/5 p-0.5",children:(0,n.jsx)(T,{player:o.player,isClickable:d})})]},l)},i=e=>{let a="player1"===e?t.player1Pieces:t.player2Pieces,l=a.filter(e=>20===e.square);return(0,n.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,n.jsx)("h3",{className:C("font-semibold","player1"===e?"text-blue-600":"text-red-600",t.currentPlayer===e&&"font-bold underline"),children:"player1"===e?"Player 1":"Player 2"}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsxs)("div",{className:"p-2 bg-stone-100 rounded",children:[(0,n.jsx)("p",{className:"text-xs text-center mb-1",children:"Start"}),(0,n.jsx)("div",{className:"grid grid-cols-4 gap-1",children:a.map((a,l)=>-1===a.square?(0,n.jsx)("div",{className:"w-5 h-5 p-0.5",onClick:()=>t.validMoves.includes(l)&&r(l),children:(0,n.jsx)(T,{player:e,isClickable:t.validMoves.includes(l)})},l):(0,n.jsx)("div",{className:"w-5 h-5"},l))})]}),(0,n.jsxs)("div",{className:"p-2 bg-emerald-100 rounded",children:[(0,n.jsx)("p",{className:"text-xs text-center mb-1",children:"Done"}),(0,n.jsx)("div",{className:"grid grid-cols-4 gap-1",children:Array(7).fill(0).map((t,r)=>(0,n.jsx)("div",{className:"w-5 h-5 rounded-full bg-emerald-300",children:r<l.length&&(0,n.jsx)("div",{className:"w-full h-full p-0.5",children:(0,n.jsx)(T,{player:e,isClickable:!1})})},r))})]})]})]})};return(0,n.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[i("player2"),(0,n.jsx)("div",{className:"bg-stone-300 p-2 rounded-lg shadow-inner",children:(0,n.jsx)("div",{className:"grid grid-cols-8 gap-0.5",children:[[16,17,18,19,-1,-1,15,14],[4,5,6,7,8,9,10,11],[0,1,2,3,-1,-1,-1,12]].flat().map((e,t)=>-1!==e?l(e,"sq-".concat(t)):(0,n.jsx)("div",{className:"bg-stone-300"},"empty-".concat(t)))})}),i("player1")]})}var W=r(2048),z=r(133);function D(e){let{gameState:t,onRollDice:r,onResetGame:a,isAIGame:l,aiThinking:s=!1}=e;return(0,n.jsxs)("div",{className:"bg-stone-100 p-2 rounded-lg space-y-2",children:[(0,n.jsx)("div",{className:"text-center font-semibold text-stone-700 h-6 flex items-center justify-center",children:"finished"===t.gameStatus?"\uD83C\uDFC6 ".concat("player1"===t.winner?"P1":"P2"," wins!"):s?"\uD83E\uDD16 AI thinking...":t.canMove?"Select a piece":0===t.diceRoll?"Rolled 0, turn skipped.":"".concat("player1"===t.currentPlayer?"P1":"P2","'s turn")}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[null===t.diceRoll?(0,n.jsx)("div",{className:"h-6"}):(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[(0,n.jsx)("span",{className:"text-sm",children:"Roll:"}),Array.from({length:4}).map((e,r)=>(0,n.jsx)("div",{className:C("w-4 h-4 rounded-full border",r<t.diceRoll?"bg-stone-800":"bg-white")},r)),(0,n.jsx)("span",{className:"text-sm font-bold w-4",children:t.diceRoll})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[!t.canMove&&"playing"===t.gameStatus&&(0,n.jsx)(E.P.button,{onClick:r,disabled:l&&"player2"===t.currentPlayer,className:"px-3 py-1 text-sm bg-blue-500 text-white rounded-md disabled:bg-stone-300",whileTap:{scale:.95},children:(0,n.jsx)(W.A,{className:"w-4 h-4"})}),(0,n.jsx)(E.P.button,{onClick:a,className:"px-3 py-1 text-sm bg-stone-500 text-white rounded-md",whileTap:{scale:.95},children:(0,n.jsx)(z.A,{className:"w-4 h-4"})})]})]})]})}function F(){let[e,t]=(0,l.useState)(()=>c()),[r,a]=(0,l.useState)(!1),[s,i]=(0,l.useState)(!1),[o,d]=(0,l.useState)("remote"),[u,y]=(0,l.useState)(!1),m=(0,l.useRef)(null);(0,l.useEffect)(()=>{R().then(()=>y(!0)).catch(console.error)},[]);let h=(0,l.useCallback)(async e=>{let r;if("player2"===e.currentPlayer&&e.canMove){i(!0);try{if("local"===o){if(!u)throw Error("WASM not ready");m.current||(m.current=new I),r=m.current.getAIMove(e)}else r=(await b.getAIMove(e)).move;setTimeout(()=>{t(e=>f(e,r)),i(!1)},500)}catch(a){console.warn("AI service unavailable, using fallback:",a);let r=b.getFallbackAIMove(e);setTimeout(()=>{t(e=>f(e,r)),i(!1)},500)}}},[o,u]);(0,l.useEffect)(()=>{r&&"player2"===e.currentPlayer&&!e.canMove&&"playing"===e.gameStatus&&setTimeout(()=>t(p),500)},[r,e.currentPlayer,e.canMove,e.gameStatus]),(0,l.useEffect)(()=>{r&&"player2"===e.currentPlayer&&e.canMove&&h(e)},[r,e.currentPlayer,e.canMove,h,e]);let g=(0,l.useCallback)(()=>t(p),[]),x=(0,l.useCallback)(r=>{e.canMove&&e.validMoves.includes(r)&&t(e=>f(e,r))},[e.canMove,e.validMoves]),v=e=>{a(e),t(c()),m.current&&(m.current.destroy(),m.current=null)};return(0,n.jsx)("div",{className:"min-h-screen bg-stone-100 flex items-center justify-center p-2",children:(0,n.jsxs)("div",{className:"w-full max-w-sm mx-auto bg-white rounded-lg shadow-lg p-4 space-y-4",children:[(0,n.jsx)("h1",{className:"text-center text-2xl font-bold text-stone-800",children:"Royal Game of Ur"}),(0,n.jsx)(D,{gameState:e,onRollDice:g,onResetGame:()=>v(r),isAIGame:r,aiThinking:s}),(0,n.jsx)(O,{gameState:e,onPieceClick:x}),(0,n.jsxs)("div",{className:"flex justify-around",children:[(0,n.jsx)("button",{onClick:()=>v(!1),className:"px-4 py-2 text-sm font-semibold rounded-lg transition-all ".concat(r?"bg-stone-200 text-stone-700 hover:bg-stone-300":"bg-blue-600 text-white"),children:"Two Player"}),(0,n.jsx)("button",{onClick:()=>v(!0),className:"px-4 py-2 text-sm font-semibold rounded-lg transition-all ".concat(r?"bg-emerald-600 text-white":"bg-stone-200 text-stone-700 hover:bg-stone-300"),children:"Play vs AI"})]}),r&&(0,n.jsxs)("div",{className:"p-2 border-t border-stone-200 text-center",children:[(0,n.jsx)("span",{className:"text-sm font-semibold text-stone-600 mr-4",children:"AI Mode:"}),(0,n.jsxs)("div",{className:"inline-flex rounded-md shadow-sm",role:"group",children:[(0,n.jsx)("button",{type:"button",onClick:()=>d("remote"),className:"px-4 py-2 text-sm font-medium rounded-l-lg border ".concat("remote"===o?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-900 border-gray-200 hover:bg-gray-100"),children:"Remote"}),(0,n.jsx)("button",{type:"button",onClick:()=>d("local"),disabled:!u,className:"px-4 py-2 text-sm font-medium rounded-r-md border-t border-b border-r ".concat("local"===o?"bg-sky-600 text-white border-sky-600":"bg-white text-gray-900 border-gray-200 hover:bg-gray-100"," disabled:opacity-50 disabled:cursor-not-allowed"),children:"Local (WASM)"})]})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[19,441,684,358],()=>t(2946)),_N_E=e.O()}]);